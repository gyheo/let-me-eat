<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">
    <title>Let Me Eat</title>
  </head>
  <body class="text-center">
    <form class="form-layout" method="post" enctype="multipart/form-data" action="/foods">
        <h1>&#127849; 렛 미 잇 &#127856;</h1>
        <h2>음식 사진을 촬영해주세요</h2>
          <img id="preview" width="50%" height="70%"/>
        <input type="file" name="image" class="form-control-file" id="image" accept="image/png, image/jpeg" onchange="readImage(this)">
        <br/>
        <button id="uploadButton" class="btn btn-lg btn-primary btn-block" type="submit" onclick="uploadImg()">전송</button>
    </form>
  </body>
  <script type="text/javascript">
    $('#inputfile').bind('change', function() {
        let fileSize = this.files[0].size / 1024 / 1024; // this gives in MB

        if (fileSize > 1) {
          $("#inputfile").val(null);
          alert('file is too big. images more than 1MB are not allowed')
          return
        }

        uploadButton.classList.add('disabled');
        uploadButton.setAttribute("disabled", "disabled");
    });

  function uploadImg() {
    const inputFile = document.querySelector("#inputFile");
    const file = inputFile.files[0];
    const uploadButton = document.querySelector("#uploadButton");

    if (!file) {
      alert("음식 이미지를 넣어주세요");
      return;
    }

    uploadButton.classList.add('disabled');

    addLoading(uploadButton);
  }

  function readImage(input) {
    if (input.files && input.files[0]) {
      let reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('preview').src = e.target.result;
      };
      reader.readAsDataURL(input.files[0]);
    } else {
      document.getElementById('preview').src = "";
    }
  }

  function addLoading(btn) {
    const spinnerSpan = document.createElement("span");
    spinnerSpan.setAttribute("aria-hidden", "true");
    spinnerSpan.setAttribute("role", "status");
    spinnerSpan.className = "spinner-border spinner-border-sm";
    
    btn.appendChild(spinnerSpan);
  }
  </script>
</html>
